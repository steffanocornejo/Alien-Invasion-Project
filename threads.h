// threads.h
// Space Invaders Game (Grid Version)
// Date Created: 2024-11-24
// Date Updated: 2025-11-26

#ifndef THREADS_H_
#define THREADS_H_

/************************************Includes***************************************/
#include "./G8RTOS/G8RTOS_Semaphores.h"
#include "./G8RTOS/G8RTOS_IPC.h"
#include "./SPI_string.h"
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <stdint.h>

/************************************Grid Config************************************/
#define SCREEN_WIDTH  240
#define SCREEN_HEIGHT 320


#define GRID_SIZE 12          // Size of each grid cell in pixels
#define BULLET_SIZE 12
#define ASTEROID_SIZE 30
#define GRID_OFFSET 0
#define MAX_X_GRID 17
#define MAX_Y_GRID 21
#define MYSTERY_SIZE 20

#define SHIP_SPEED 2
#define ASTEROID_MIN_SIZE 8
#define ASTEROID_MAX_SIZE 16
#define SPAWN_RATE 50
#define MAX_BULLETS 100
#define MAX_ASTEROIDS 10


// FIFO Indices
#define ACCEL_FIFO 0
#define JOYSTICK_FIFO 1


/***********************************Semaphores**************************************/
semaphore_t sem_UART;
semaphore_t sem_I2CA;
semaphore_t sem_SPIA;
semaphore_t sem_gameState;
semaphore_t sem_Bullet;
semaphore_t sem_ScoreChange;
semaphore_t sem_gameOver;
semaphore_t sem_Mystery;
semaphore_t sem_PCA9555_Debounce;
semaphore_t sem_Joystick_Debounce;

/************************************Enums******************************************/

typedef enum {
    EASY = 1,
    MEDIUM = 2,
    HARD = 3
} Difficulty_t;

typedef enum {
    GAME_OVER = 1,
    GAME_RUNNING = 2,
    GAME_PAUSED = 3,
    GAME_LEVEL = 4
} gameState_t;

/***********************************Structures**************************************/

// Ship structure - Now uses Grid Row/Col instead of X/Y pixels
typedef struct {
    int16_t row;
    int16_t col;
    bool alive;
} Mystery_t;

typedef struct {
    int16_t row;          // Grid Row (0 to MAX_Y_GRID)
    int16_t col;          // Grid Col (0 to MAX_X_GRID)
    int16_t cannon_angle; // Angle of the cannon
    bool alive;
} Ship_t;

// Asteroid structure
typedef struct Asteroid_t {
    int16_t row;
    int16_t col;
    int16_t v_row;        // Velocity in grid units
    int16_t v_col;        // Velocity in grid units
    uint8_t size;         // Size in grid units?
    bool active;
    struct Asteroid_t* next;
} Asteroid_t;

// Bullet structure
typedef struct Bullet_t {
    int16_t row;
    int16_t col;
    int16_t v_row;
    int16_t v_col;
    bool active;
} Bullet_t;

// Game Board structure
typedef struct {
    Ship_t ship;
    Asteroid_t* asteroids_head;
    Bullet_t* bullets_head;
    uint8_t level;
    gameState_t state;
    Difficulty_t difficulty;
    Mystery_t mystery;

} GameBoard_t;

/***********************************Globals*****************************************/
extern GameBoard_t g_gameBoard;
extern volatile bool buttonPressed;

static const uint16_t pixel_ship[] = {
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x6b4d, 0x52aa, 0x94b2, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x630c, 0xce59, 0x31a6, 0x8410, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x10a2, 0xad55, 0xad55, 0x8410, 0x8410, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xef5d, 0x9cd3, 0x8410, 0x8410, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x39e8, 0x52aa, 0xce59, 0xf7be, 0x7bf0, 0x2167, 0x0186, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0861, 0x19aa, 0x4a8b, 0xb596, 0x7bcf, 0x8451, 0x322c, 0x08a5, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0862, 0x2a4e, 0x52cb, 0xf7be, 0xf79e, 0xa534, 0x5330, 0x0863, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x10a3, 0x32af, 0x52ab, 0x8410, 0xce79, 0x6b4d, 0x63b2, 0x08a5, 0x39c7, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x001f, 0x0863, 0x11ab, 0x7c53, 0x5aeb, 0xe71c, 0xce79, 0xa514, 0xad97, 0x198a, 0x21cb, 0x19c7, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x1925, 0x11ab, 0x19ab, 0xdefb, 0x634c, 0xe73c, 0x630c, 0xad55, 0xdedb, 0x73d2, 0x116a, 0x10c6, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x2106, 0x1949, 0x19cb, 0x5410, 0xd69a, 0x6b4d, 0xf79e, 0xbdd7, 0xad55, 0xd69a, 0xb638, 0x21ec, 0x198a, 0x08a4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3186, 0x198a, 0x220d, 0x294a, 0xad55, 0xd69a, 0x738e, 0xd6ba, 0xdedb, 0xa514, 0xce79, 0xef5d, 0x02aa, 0x21cb, 0x21ac, 0x2966, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x10a2, 0x1108, 0x21ca, 0x4208, 0xbdf7, 0xd5b6, 0xa2ca, 0xc38e, 0xcb8e, 0xb30c, 0xd596, 0xbdf7, 0x52aa, 0x2a0a, 0x1128, 0x0843, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0882, 0x630c, 0x39e7, 0x39e7, 0xa4f3, 0xcd14, 0xb492, 0xb471, 0xcd54, 0x9c71, 0x39e7, 0x39e7, 0x39e7, 0x10c4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0861, 0x6b6d, 0x8c51, 0x8410, 0x7bef, 0xc5f7, 0xad55, 0xad55, 0xce59, 0x8410, 0x7bef, 0x8430, 0x632c, 0x31a6, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x18c3, 0x18c3, 0x18c3, 0x4208, 0x4a49, 0x4208, 0x39e7, 0x4a69, 0x4208, 0x2104, 0x18c3, 0x18c3, 0x4a69, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0x0000, 0x0000, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000
};


static const uint16_t pixel_rock[] = {
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x52a7, 0x730b, 0x93ed, 0x7b2a, 0x940d, 0x8bec, 0x8bed, 0x6aea, 0x52a5, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x8400, 0x5ac9, 0x730a, 0x730a, 0x834b, 0x93ed, 0x7b2a, 0x9c2d, 0x836b, 0x838c, 0x5227, 0x49e6, 0x5206, 0x5a28, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x4986, 0x5a88, 0x6288, 0x7309, 0x836b, 0x7b2a, 0x6246, 0x6aa8, 0x7b4a, 0x49c5, 0x20c2, 0x20c2, 0x3964, 0x6ac9, 0x6267, 0x49c7, 0x52aa, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x30c3, 0x49e6, 0x6267, 0x72e9, 0x7b09, 0x6aa8, 0x72e9, 0x72a8, 0x836b, 0x7309, 0x5206, 0x41a5, 0x41a5, 0x49c5, 0x6a88, 0x6ac9, 0x5a68, 0x6aca, 0x8408, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3183, 0x3984, 0x41a5, 0x6aa8, 0x6267, 0x49c5, 0x3143, 0x6288, 0x72e9, 0x834a, 0x8b8b, 0x6ac8, 0x7b09, 0x5a47, 0x5206, 0x6267, 0x72c9, 0x6288, 0x72ea, 0x7309, 0x52a0, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3984, 0x41a5, 0x5226, 0x5226, 0x72c9, 0x4185, 0x2903, 0x6aa8, 0x6aa8, 0x6267, 0x72c9, 0x6ac8, 0x6aa8, 0x49a5, 0x3964, 0x49c5, 0x5a47, 0x5206, 0x6ac8, 0x6267, 0x5a27, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x5247, 0x41a5, 0x3143, 0x3144, 0x51e5, 0x5a06, 0x72c9, 0x6288, 0x5206, 0x5a27, 0x51e6, 0x5a46, 0x5a26, 0x6267, 0x6aa8, 0x5a26, 0x49c5, 0x5a47, 0x5a67, 0x6288, 0x6267, 0x5a47, 0x6269, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x6186, 0x5a48, 0x49c5, 0x28e2, 0x1061, 0x4184, 0x5a06, 0x49c5, 0x3943, 0x3943, 0x4185, 0x51e5, 0x51e5, 0x6267, 0x5206, 0x5206, 0x4184, 0x3123, 0x6288, 0x5206, 0x5226, 0x49a4, 0x5a47, 0x6289, 0x52a0, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x5227, 0x5a27, 0x3122, 0x18a1, 0x1061, 0x3123, 0x49c5, 0x4184, 0x4184, 0x51e6, 0x51e6, 0x4184, 0x49c5, 0x41a4, 0x41a5, 0x3123, 0x3943, 0x3944, 0x41a4, 0x4184, 0x49a5, 0x2903, 0x3123, 0x4a06, 0x4206, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x5207, 0x5206, 0x3964, 0x2903, 0x2903, 0x4185, 0x49a5, 0x41a4, 0x49a5, 0x5a47, 0x49c5, 0x3144, 0x3964, 0x41a5, 0x4184, 0x49c5, 0x3964, 0x4184, 0x41c5, 0x41a5, 0x5206, 0x3964, 0x20c2, 0x41a5, 0x41a5, 0x8000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x62c9, 0x7b4b, 0x49a4, 0x3963, 0x4164, 0x49e5, 0x49c5, 0x3964, 0x41a5, 0x3103, 0x3944, 0x3143, 0x49c5, 0x49c5, 0x4184, 0x5206, 0x5a27, 0x49a5, 0x3943, 0x3102, 0x3123, 0x49c5, 0x3103, 0x49e6, 0x5227, 0x52a7, 0x0000,
  0x0000, 0x0000, 0x0000, 0x5a47, 0x7b09, 0x72e9, 0x6288, 0x6267, 0x5206, 0x3964, 0x28e2, 0x3964, 0x3964, 0x49c5, 0x5206, 0x5206, 0x51e6, 0x6a88, 0x6a88, 0x5206, 0x41a4, 0x41a4, 0x49a5, 0x4184, 0x51e5, 0x5206, 0x51e5, 0x49e5, 0x49c7, 0x0000,
  0x0000, 0x0000, 0x4200, 0x3985, 0x49c5, 0x7b09, 0x7309, 0x5226, 0x4164, 0x3943, 0x3964, 0x4184, 0x28e2, 0x3123, 0x6267, 0x6247, 0x5a27, 0x5a27, 0x5a27, 0x6247, 0x5a26, 0x3964, 0x3964, 0x5206, 0x49c5, 0x5206, 0x49e5, 0x3984, 0x2945, 0x0000,
  0x0000, 0x0000, 0x0000, 0x3164, 0x4164, 0x49e5, 0x49a5, 0x4184, 0x3964, 0x3923, 0x3103, 0x3103, 0x2902, 0x5227, 0x49e6, 0x20c2, 0x20c2, 0x18a2, 0x20a2, 0x3964, 0x5206, 0x49c5, 0x49c5, 0x49c5, 0x3923, 0x3964, 0x49c5, 0x3944, 0x5000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x4185, 0x49e6, 0x3964, 0x3944, 0x3944, 0x41a5, 0x3123, 0x2903, 0x4a06, 0x4184, 0x5206, 0x28e2, 0x18a2, 0x20a2, 0x1081, 0x0840, 0x18a2, 0x5206, 0x5a47, 0x4184, 0x4184, 0x3944, 0x4184, 0x51e6, 0x49a4, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x4a06, 0x49e6, 0x3143, 0x3923, 0x3944, 0x49a5, 0x4184, 0x28e2, 0x3944, 0x49e5, 0x49c5, 0x20c2, 0x1081, 0x1061, 0x1881, 0x1061, 0x1061, 0x4184, 0x49c5, 0x3963, 0x3963, 0x49c5, 0x6267, 0x49e6, 0x41a5, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x49c4, 0x41a5, 0x28e2, 0x3944, 0x3944, 0x3143, 0x2902, 0x28e3, 0x41a5, 0x49c5, 0x4184, 0x28e2, 0x18a2, 0x0840, 0x0841, 0x1081, 0x1041, 0x28e3, 0x41a4, 0x4184, 0x41a4, 0x51e6, 0x49c5, 0x41a5, 0x4165, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x8000, 0x3123, 0x20e2, 0x3123, 0x3964, 0x3123, 0x3123, 0x28e2, 0x41a4, 0x5206, 0x41a4, 0x3103, 0x20c2, 0x1881, 0x0841, 0x1061, 0x20c2, 0x3143, 0x4164, 0x49e6, 0x49a5, 0x4184, 0x49c6, 0x3985, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x28a2, 0x3143, 0x49e6, 0x49c5, 0x51e6, 0x5a26, 0x5206, 0x6267, 0x49e5, 0x49a5, 0x4185, 0x3944, 0x2903, 0x2903, 0x3123, 0x3964, 0x5206, 0x5206, 0x49e5, 0x5226, 0x5a27, 0x49c6, 0x4208, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x4a66, 0x41a4, 0x51e6, 0x5a26, 0x6a88, 0x5206, 0x49c5, 0x51e5, 0x5a27, 0x5a47, 0x6268, 0x49c5, 0x5206, 0x51e6, 0x5a26, 0x5a26, 0x49c5, 0x5206, 0x49a5, 0x4a06, 0x3186, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3183, 0x41a5, 0x51e6, 0x6267, 0x5a06, 0x49c5, 0x41a4, 0x5a47, 0x72e9, 0x5a26, 0x6aa8, 0x7b09, 0x6a87, 0x6ac8, 0x6267, 0x5a47, 0x49e5, 0x41a5, 0x3186, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x4924, 0x5206, 0x5226, 0x5a68, 0x6288, 0x5a47, 0x6267, 0x6a87, 0x6247, 0x72e9, 0x7b09, 0x7b09, 0x6a88, 0x5206, 0x5a47, 0x4a66, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x6326, 0x52a8, 0x6288, 0x5a48, 0x62a8, 0x6aa8, 0x6288, 0x6ac9, 0x6aa8, 0x6267, 0x6268, 0x5208, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x5145, 0x5a47, 0x5a68, 0x6186, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000
};

static const uint16_t pixel_bullet[]  = {
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xffff, 0xffff, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x1084, 0x6c9c, 0x4a9c, 0x1084, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x6b6b, 0x8aac, 0x6aac, 0x2a73, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x2a7b, 0x28ac, 0x28ac, 0x297b, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xa86a, 0xa793, 0xa79b, 0xa872, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xe872, 0x07a4, 0xc7a3, 0xa67a, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xc87a, 0x27bc, 0xe6b3, 0x447a, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xa872, 0x27bc, 0x06bc, 0x447a, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xc87a, 0x27bc, 0x07bc, 0x447a, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xa872, 0xe7ab, 0xc6b3, 0x4472, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x676a, 0x0583, 0x0593, 0x446a, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000
};

static const uint16_t pixel_mystery[] = {
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x3000, 0x9142, 0xeaa4, 0xfaa4, 0xfaa4, 0xfaa4, 0xfaa4, 0xfaa4, 0xfaa4, 0xfaa4, 0xfaa2, 0xfb26, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xa202, 0x89c1, 0xfb23, 0xfb43, 0xfb43, 0xfb43, 0xfb43, 0xfb43, 0xfb43, 0xfb23, 0xeac3, 0x9a01, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xd2e2, 0xebc2, 0xd461, 0xfd61, 0xfd41, 0xfd41, 0xfd41, 0xfd61, 0xfd61, 0xcc61, 0x8ac0, 0x6180, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xfb83, 0xfc22, 0xdd00, 0xfd61, 0xf3a2, 0xcb42, 0xe362, 0xfce1, 0xf5a0, 0xd500, 0x7ae0, 0x3940, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xfb83, 0xfc62, 0xfdc1, 0xfc82, 0xca43, 0x59e0, 0xaac1, 0xeac3, 0xd4a0, 0xf5a0, 0x8300, 0x3940, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xfb83, 0xfc62, 0xfdc1, 0xf4a1, 0xaa22, 0xabc0, 0xfc42, 0xda63, 0x9b60, 0xed80, 0x8300, 0x3940, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xfb83, 0xfc62, 0xfde1, 0xfdc0, 0xb420, 0xdbc2, 0xc243, 0x6141, 0x9b80, 0xeda0, 0x8300, 0x3940, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xfb83, 0xfc62, 0xfde1, 0xfe00, 0xfde1, 0xf462, 0x7981, 0xbc40, 0xf5a0, 0xf5c0, 0x8300, 0x3940, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xfb83, 0xfc62, 0xfde1, 0xfe00, 0xfde1, 0xfc22, 0xc2e2, 0xed60, 0xfde0, 0xfdc0, 0x8300, 0x3940, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xfb83, 0xf422, 0xc480, 0xfde0, 0xfde0, 0xf4c1, 0x6981, 0xccc0, 0xf5c0, 0xbc60, 0x7ac0, 0x3940, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xb241, 0xb301, 0xa3c0, 0xb440, 0xb440, 0xb420, 0x8b20, 0xac00, 0xb420, 0x9ba0, 0x5200, 0x20e0, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x7141, 0x28c0, 0x3100, 0x3120, 0x3120, 0x3120, 0x2900, 0x3120, 0x3120, 0x2900, 0x18a0, 0x1860, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000
};

static const uint16_t lazer_pixel[] = {
  0x0000, 0x0000, 0x0000, 0xaf5e, 0x8f1f, 0x869f, 0x9efe, 0xbf5e, 0xcf7e, 0x0000, 0x0000, 0x0000,
  0x0000, 0xc75e, 0x76de, 0x569e, 0x3e3e, 0x56de, 0x66dd, 0x3e3e, 0x6e9e, 0x9f1d, 0x0000, 0x0000,
  0x0000, 0xaf3d, 0x977f, 0x66bd, 0x3ebe, 0x877e, 0x7f9e, 0x3efe, 0x5e7e, 0x767e, 0xbf3e, 0x0000,
  0x0000, 0xaf5d, 0x7f5e, 0x669e, 0x46bf, 0x779e, 0x779f, 0x36bf, 0x66be, 0xb79e, 0x0000, 0x0000,
  0x0000, 0x0000, 0xcf9e, 0xaf7e, 0x86ff, 0x477f, 0x3f5e, 0x56be, 0xaf5e, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x9f3d, 0x46fe, 0x4f1e, 0x86dd, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x8f3d, 0x3ede, 0x56fd, 0x86bd, 0xbf5e, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xaf7d, 0x573e, 0x3f3e, 0x8efd, 0xc77e, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xbf7d, 0x4f3e, 0x4f5e, 0x9f5e, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0xc77d, 0x571e, 0x4f1e, 0x9edd, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x871e, 0x6f3e, 0xaf1d, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xa77e, 0x873e, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000
};

/********************************Background Threads*********************************/
void Init_Thread(void);
void Player_Thread(void);           // Grid-based movement
void Spawn_Asteroids_Thread(void);
void Board_Thread(void);
void Read_Buttons_Thread(void);
void Change_Level_Thread(void);
void Create_Bullet_Thread(void);
void Game_Over_Thread(void);
void Idle_Thread(void);
void Mystery_Box_Thread(void);

/********************************Periodic Threads***********************************/
void Play_Music(void);
void Read_Joystick(void);
void Lose_Condition(void);

/********************************Aperiodic Threads**********************************/
void Button_Handler(void);
void GPIOE_Handler(void);

/********************************Helper Functions***********************************/
// Linked List Management
Bullet_t* Create_Bullet(int16_t row, int16_t col, int16_t v_row, int16_t v_col);
void Add_Bullet(Bullet_t** head, Bullet_t* new_bullet);
void Remove_Bullet(Bullet_t** head, Bullet_t* bullet);


Bullet_t* Create_Bullet(int16_t r, int16_t c, int16_t vr, int16_t vc);
void Add_Bullet(Bullet_t** head, Bullet_t* new_bullet);
void Remove_Bullet(Bullet_t** head, Bullet_t* bullet);

// Game Logic
void Init_Game(void);
void Init_Ship(Ship_t* ship);

// Display Functions
void Draw_Ship(Ship_t* ship);

#endif /* THREADS_H_ */
